## 데이터 링크 계층 프로토콜 기초
#### 개념
- 두 호스트가 통신하려면 일대일 형식의 점대점 방식으로 연결 

#### 프레임
1. 정보 프레임(=I 프레임)
    - 상위 계층에서 보낸 데이터와 함께 프레임의 순서번호, 송수신 호스트의 주소 정보 포함 </br>
    📍 순서번호 : 각 정보 프레임에 부여되는 고유의 일련번호

2. 긍정 응답 프레임(=ACK 프레임; Positivie Acknowledgement)
    - 전송 데이터가 올바르게 도착했음을 회신하는 용도로 사용되며 데이터를 수신한 호스트가 데이터를 송신한 호스트에 전송하는 프레임

3. 부정 응답 프레임(=NAK 프레임; Negative Acknowledgment)
    - 전송 데이터가 깨져서 도착했음을 회신하는 용도로 사용
    - 데이터를 수신한 호스트가 데이터를 송신한 호스트에게 전송하며 데이터를 송신한 호스트는 원래의 데이터를 재전송하여 오류 복구

<br/>

## 슬라이딩 윈도우 프로토콜
### 개념
- 두 호스트 간 데이터 전송을 위한 일반적인 통신 프로토콜로 오류 제어와 흐름 제어를 함께 지원

### 절차
- 송신 호스트는 정보 프레임(전송 데이터, 순서 번호, 오류 검출 코드)을 순서 번호에 따라 순차적 전송
- 정보 프레임을 수신한 수신 호스트가 응답하는 순서번호는 정상적으로 수신한 번호가 아닌, 다음에 수산하기를 기대하는 번호를 회신하는 것을 사용
- 송신 호스트는 송신한 정보 프레임을 자신의 내부 버퍼인 송신 윈도우를 유지해야 한다.
    
    송신 호스트가 관리하는 송신 위도우는 전송은 되었지만 긍정 응답이 회신되지 않은 프레임을 보관
    
- 수신 호스트는 수신한 정보 프레임을 보관하기 위한 내부 버퍼인 수신 윈도우를 유지해야 한다.
    
    수신 호스트가 관리하는 수신 윈도우는 **프로토콜 동작 방식**에 따라 크기가 달라진다. </br>
    📍 프로토콜 동작 방식
    1. 선택적 재전송
    2. Go-Back-N 방식
    3. Piggy Backing 방식

### 흐름 제어
- 순서 번호(Seq)
    - 프레임 별로 부여되는 일련의 번호
    - 수신 호스트와 송신 호스트가 정보 프레임을 구별하기 위해서 순서번호를 사용
    - 0부터 임의의 최댓값 까지 순환 방식 사용
    - 순서 번호의 최댓값이 송신 윈도우 크기보다 커야 한다
        
        why? 
        
        - 순서를 다시 지정할때 최댓값 이후에는 다시 0번으로 순서를 지정하기 때문에 송신 윈도우의 크기가 더 클경우 순서 번호가 겹치는 현상이 발생할 수 있기 때문에
- 윈도우 크기(=Buffer size)
    - 긍정 응답 프레임을 받지 않고도 연속으로 전송할 수 있는 프레임의 개수
    - 송신 윈도우에 보관된 프레임은 수신 호스트에 전송되었으나 아직 긍정 응답을 받지 못한 프레임
    - 윈도우에 포함된 정보 프레임의 관리는 순서 번호를 기반으로 이루어지는데 낮은 순서번호부터 처리

### 연속형 전송 
- ACK 프레임을 받지 않고 <span style="color:violet" > 여러 프레임을 연속으로 전송할 수 있는 방식 </span>
- Go-Back-N 방식 <br/>
    <img src="/img/GoBackN.png" width="400" height="400">
    - 오류가 발생한 12번 프레임을 포함해 ** 이후 전송된 모든 정보 프레임을 재전송** 하는 방식

- 선택적 재전송 방식 <br/>
    <img src="/img/선택적재전송.png" width="400" height="400">
    - 오류가 발생한 프레임만 선택적으로 복구하는 방식 

- Piggy Backing(피기 배킹) <br/>
    <img src="/img/피기배킹.png" width="400" height="400">
    - 양방향으로 동시에 정보 프레임과 응답 프레임을 교차하여 전송하는 경우를 사용하는 방식
    - 정보 프레임과 응답 프레임을 각각 보내는 것이아닌, 정보 프레임을 전송하면서 응답 기능까지 동시에 수행하도록 프레임 구조를 변형 시킨것.

<br/>

## HDLC 프로토콜
### 개념
- 컴퓨터가 일대일 혹은 일대다로 연결된 환경에 데이터의 송수신 기능을 제공
- 단방향 ,반이중, 전이중 통신을 모두 지원
- 동기식 전송 방식을 사용
- 오류 제어를 위해 **Go-Back-N**과 **선택적 재전송(Selective Repeat) ARQ**를 사용
- 흐름 제어를 위해 **슬라이딩 윈도우 방식** 사용
- 전송 제어상의 제한을 받지 않고 자유롭게 비트 정보를 전송할 수 있다 (비트 투과성)
- 전송 효율과 신뢰성이 높다.


### 기본 용어
- 호스트 : 데이터 통신을 위해 연결된 컴퓨터
- 주국 : `명령(command)을 전송`하는 호스트
- 종국 : `명령에 응답(Respond)`하는 호스트
- 혼합국 : 주국 + 종국
- 명령(Command) : 주국에서 전송되는 메시지
- 응답(Response) : 종국에서의 회신되는 메시지


### HDLC 프레임 구조
> <span style="color:#6499E9" > 비트 </span> 프레임 방식 사용 
<br/>

<img src="/img/HDLC 프레임.png" width="400" height="400">

- 프레임 죄우에 위치한 01111110 플래그는 프레임 시작과 끝을 구분
- Address(주소) :  일대다 연결된 환경에서 특정 호스트를 구분하여 지칭하는 목적으로 사용
- Control : 프레임 종류 구분
    1. 정보 프레임
        - 3비트의 `순서번호`를 이용한 슬라이딩 윈도우 프로토콜 사용
            - 순서번호는 비트 수가 3개 이므로 0 ~7의 순서 번호 8개를 순환하여 사용
            - seq : 정보 프레임의 송신용 순서번호로 사용
            - Next : 피기 배킹을 이용한 응답 기능으로 사용
            - P/F : 값이 1로 지정되었을 경우에 한하여 Poll 혹은 Final 의미를 갖는다.
    2. 감동 프레임 : 정보 프레임에 대한 응답 기능을 수행하는 프레임
        - 긍정 응답 프레임과 부정 응답 프레임으로 구분 <br/>
        ![](/img/감독프레임.png)
            - Type 0 : 긍정 응답 프레임
            - Type 1 : 부정 응답프레임
            - Type2 : 흐름 제어 기능까지 제공
            - Type3 :  선택적 재전송 방식에서 부정 응답 기능 제공
    3. 비번호 프레임
        - 순서 번호가 없는 프레임을 정의
        - Type과 Modifier 필드를 합해 총 5비트로 프레임 정의
        - 주로 `연결`을 제어할때 사용되는 프레임
            1. 정규 응답(Nomal Response)
                - 주국과 종국으로 이루어져 있어, 종국은 반드시 주국의 허락을 받아야만 데이터 전송이 가능하다.
                - **주국 → 종국에게 SNRM(Set Nomal Response Mode) 명령을 보내고 종국 → 주국에게 UA(Unnumbered ACK)로 응답해야 연결 성립**
        
            2. 비동기 균형(Asynchronous Balanced) 
                - `혼합국으로 동작`하며, `양쪽에서 명령과 응답`을 할 수 있다.
                - 둘중하나가 SABM(Set Asynchronous Balanced Mode)명령을 보내고 상대가 UA로 응답하면 연결 성립 <br/>
                    → 대표적 LAPB(Link Access Protocol-Balanced) 프로토콜 해당
                
            3. 비동기 응답(Asynchronous Response) 
                - 주국과 종국 같은 `불균형 연결 모드`이나 종국이 주국의 `허락 없이 데이터를 전송`할 수 있는 권한을 갖는다.
                - P/F 비트의 지정없이도 종국이 먼저 SARM(Set Asynchronuous Response Mode) 응답을 보낼 수 있다.
                - 응답을 받은 주국은 SARM 명령을 종국에게 보내고 종국은 UA로 응답함으로써 연결 성립
                - 대표적 : LAP(Link Access Protocol)
- Data : 가변 크기의 전송 데이터 호마, 상위 계층인 네트워크 계층에서 보내진 패킷이 캡슐화된다.
- checksum :  오류 검출 용도로 사용


<br/>

## LAP 프로토콜

<img src="/img/LAP.png" width="400" height="400" align="center">

- 비동기 응답 모드인 ARM으로 동작하는 프로토콜
- 주국에서 전송된 SARM 명령에 대한 종국에서 UA응답을 전송함으로써 완료

<br/>

## LAPB 프로토콜

<img src="/img/LAPB.png" width="400" height="400" align="center">

- 주국은 명령만 하고 종국은 리액션만 해야 하는데, 이걸 극복하기 위해 혼합국사용
- 필요에 따라 누구든 응답과 전송을 할 수 있다.